---

title: Testing features


keywords: fastai
sidebar: home_sidebar

summary: "Testing the impact on features, generated in `preprocessing`, on the model performance"
description: "Testing the impact on features, generated in `preprocessing`, on the model performance"
nb_path: "nbs/feature_testing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/feature_testing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading">Loading<a class="anchor-link" href="#Loading"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">loading</span><span class="o">.</span><span class="n">N_TRAIN</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">loading</span><span class="o">.</span><span class="n">N_TEST</span> <span class="o">=</span> <span class="mi">10_000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ashrae_data</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">load_all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Executing-the-pre-processing">Executing the pre-processing<a class="anchor-link" href="#Executing-the-pre-processing"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">tfms_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;add_time_features&#39;</span><span class="p">:{},</span>
    <span class="s1">&#39;add_weather_features&#39;</span><span class="p">:{</span><span class="s1">&#39;fix_time_offset&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;add_na_indicators&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span>
                            <span class="s1">&#39;impute_nas&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">},</span>
    <span class="s1">&#39;add_building_features&#39;</span><span class="p">:{},</span>
<span class="p">}</span>

<span class="n">df</span><span class="p">,</span> <span class="n">df_test</span><span class="p">,</span> <span class="n">var_names</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">preprocess_all</span><span class="p">(</span><span class="n">ashrae_data</span><span class="p">,</span> <span class="n">tfms_config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">#df = load_df(data_path/&#39;X.parquet&#39;)</span>

<span class="o">%</span><span class="n">time</span>
<span class="c1">#df_test_p = load_df(data_path/&#39;X_test.parquet&#39;)</span>

<span class="o">%</span><span class="n">time</span>
<span class="c1">#var_names = load_var_names(data_path/&#39;var_names.pckl&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Testing-if-certain-features-improve-the-score-beyond-the-baseline">Testing if certain features improve the score beyond the baseline<a class="anchor-link" href="#Testing-if-certain-features-improve-the-score-beyond-the-baseline"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Training to get a basic idea if the added features do have any benefit</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_tabular_object" class="doc_header"><code>get_tabular_object</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_tabular_object</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>var_names</code></strong>:<code>dict</code>, <strong><code>splits</code></strong>=<em><code>None</code></em>, <strong><code>procs</code></strong>:<code>list</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_predict" class="doc_header"><code>train_predict</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_predict</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>var_names</code></strong>:<code>dict</code>, <strong><code>model</code></strong>, <strong><code>model_params</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>n_rep</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>n_samples_train</code></strong>:<code>int</code>=<em><code>10000</code></em>, <strong><code>n_samples_valid</code></strong>:<code>int</code>=<em><code>10000</code></em>, <strong><code>procs</code></strong>:<code>list</code>=<em><code>[&lt;class 'fastai.tabular.core.Categorify'&gt;, &lt;class 'fastai.tabular.core.FillMissing'&gt;, &lt;class 'fastai.data.transforms.Normalize'&gt;]</code></em>, <strong><code>split_params</code></strong>:<code>dict</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">split_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">split_kind</span> <span class="o">=</span> <span class="s1">&#39;time_split_day&#39;</span><span class="p">,</span>
    <span class="n">t_train</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train_frac</span> <span class="o">=</span> <span class="o">.</span><span class="mi">8</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span>
                <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestRegressor</span>
<span class="c1"># params = {}</span>
<span class="c1"># model = linear_model.LinearRegression</span>
<span class="n">n_rep</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_samples_train</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">n_samples_valid</span> <span class="o">=</span> <span class="mi">10_000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following is not always necessary. Sensible in the case of a linear model to remove categorical values which are not onehot encoded</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># for k in [&#39;cats&#39;, &#39;conts&#39;]:</span>
<span class="c1">#     var_names[k] = [_v for _v in var_names[k] if _v not in to_remove[k]]</span>
<span class="c1"># var_names</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">procs</span> <span class="o">=</span> <span class="p">[</span><span class="n">Categorify</span><span class="p">,</span> <span class="n">FillMissing</span><span class="p">,</span> <span class="n">Normalize</span><span class="p">]</span>
<span class="n">df_rep</span> <span class="o">=</span> <span class="n">train_predict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">var_names</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">model_params</span><span class="o">=</span><span class="n">model_params</span><span class="p">,</span> 
                       <span class="n">n_rep</span><span class="o">=</span><span class="n">n_rep</span><span class="p">,</span> <span class="n">n_samples_train</span><span class="o">=</span><span class="n">n_samples_train</span><span class="p">,</span>
                       <span class="n">n_samples_valid</span><span class="o">=</span><span class="n">n_samples_valid</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">,</span>
                       <span class="n">split_params</span><span class="o">=</span><span class="n">split_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_rep</span><span class="p">[</span><span class="s1">&#39;rmse loss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">px</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">df_rep</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;rmse loss&#39;</span><span class="p">,</span> <span class="n">range_y</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Baseline model = RandomForest with 20 estimators and sqrt features, training over 100k samples and predicting over 1k</p>
<table>
    <tr>
        <th>input</th>
        <th>model</th>
        <th>rmse loss</th>
        <th>time [s/it]</th>
    </tr>
    <tr>
        <td>meter and building id only</td>
        <td>random forest</td>
        <td>1.2 - 1.21</td>
        <td>10.2</td>
    </tr>
    <tr>
        <td>using dep_var stats</td>
        <td>random forest</td>
        <td>1.16 - 1.18</td>
        <td>17.3</td>
    </tr>
    <tr>
        <td>using time stats</td>
        <td>random forest</td>
        <td>1.2 - 1.21</td>
        <td>13.2 - 13.7</td>
    </tr>
    <tr>
        <td>using building info</td>
        <td>random forest</td>
        <td>1.19</td>
        <td>17 - 18</td>
    </tr>
    <tr>
        <td>using weather (+ building) info</td>
        <td>random forest</td>
        <td>1.13 - 1.139</td>
        <td>14.6 - 15</td>
    </tr>
    <tr>
        <td>using all above</td>
        <td>random forest</td>
        <td>1.19 - 1.21</td>
        <td>20 - 26</td>
    </tr>
    <tr>
        <td>removing leading 0s in `dep_var`</td>
        <td>random forest</td>
        <td>.36 - .37</td>
        <td>4</td>
    </tr>
    <tr>
        <td>removing trailing 0s in `dep_var`</td>
        <td>random forest</td>
        <td>1.2</td>
        <td>4</td>
    </tr>
    <tr>
        <td>removing empty weeks before the first full week</td>
        <td>random forest</td>
        <td>1.16</td>
        <td>4</td>
    </tr>
    <tr>
        <td>meter only</td>
        <td>linear model</td>
        <td>2.2</td>
        <td>5</td>
    </tr>
    <tr>
        <td>meter + hour</td>
        <td>linear model</td>
        <td>2.1</td>
        <td>5</td>
    </tr>
    <tr>
        <td>meter reading stats only (meter, building_id, hour)</td>
        <td>linear model</td>
        <td>1.23 - 1.24 / 1.68 - 1.7</td>
        <td>5</td>
    </tr>
    <tr>
        <td>meter + meter reading stats (meter, building_id, hour)</td>
        <td>linear model</td>
        <td>1.51 - 1.52</td>
        <td>5</td>
    </tr>
    <tr>
        <td>meter reading stats (meter, building_id, hour)</td>
        <td>random forest</td>
        <td>0.58 - 0.6</td>
        <td>5</td>
    </tr>
    <tr>
        <td>meter + meter reading stats (meter, building_id, hour)</td>
        <td>random forest</td>
        <td>1.21 - 1.22</td>
        <td>5</td>
    </tr>
</table>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting-predictions-with-a-single-model">Plotting predictions with a single model<a class="anchor-link" href="#Plotting-predictions-with-a-single-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Comparing-dep_var-distributions">Comparing <code>dep_var</code> distributions<a class="anchor-link" href="#Comparing-dep_var-distributions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">df</span><span class="p">,</span> <span class="n">df_test</span><span class="p">,</span> <span class="n">var_names</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">preprocess_all</span><span class="p">(</span><span class="n">ashrae_data</span><span class="p">,</span> <span class="n">tfms_config</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">splits</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">split_dataset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">**</span><span class="n">split_params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">to</span> <span class="o">=</span> <span class="n">get_tabular_object</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">var_names</span><span class="p">,</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">,</span> <span class="n">procs</span><span class="o">=</span><span class="n">procs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;max_features&#39;</span><span class="p">:</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span>
          <span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestRegressor</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">_X</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">xs</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples_train</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">_y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples_train</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">_X</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">_X</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples_valid</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">_y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n_samples_valid</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">_X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hist_plot_preds" class="doc_header"><code>hist_plot_preds</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hist_plot_preds</code>(<strong><code>y0</code></strong>:<code>ndarray</code>, <strong><code>y1</code></strong>:<code>ndarray</code>, <strong><code>label0</code></strong>:<code>str</code>=<em><code>'y0'</code></em>, <strong><code>label1</code></strong>:<code>str</code>=<em><code>'y1'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hist_plot_preds</span><span class="p">(</span><span class="n">_y</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label0</span><span class="o">=</span><span class="s1">&#39;truth (valid)&#39;</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;prediction (valid)&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inspecting-confidently-wrong-predictions">Inspecting confidently wrong predictions<a class="anchor-link" href="#Inspecting-confidently-wrong-predictions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="BoldlyWrongTimeseries" class="doc_header"><code>class</code> <code>BoldlyWrongTimeseries</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L85" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>BoldlyWrongTimeseries</code>(<strong><code>xs</code></strong>, <strong><code>y_true</code></strong>, <strong><code>y_pred</code></strong>, <strong><code>info</code></strong>:<code>DataFrame</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">_X</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span> 
<span class="n">_y</span> <span class="o">=</span> <span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> 
<span class="n">pred</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">_y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">bwt</span> <span class="o">=</span> <span class="n">BoldlyWrongTimeseries</span><span class="p">(</span><span class="n">to</span><span class="o">.</span><span class="n">valid</span><span class="o">.</span><span class="n">xs</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;building_id&#39;</span><span class="p">,</span> <span class="s1">&#39;meter&#39;</span><span class="p">,</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]],</span> <span class="n">lsuffix</span><span class="o">=</span><span class="s1">&#39;to_&#39;</span><span class="p">),</span> 
                            <span class="n">_y</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Adding plotting capability based on the loss or meter/building id</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BoldlyWrongTimeseries.plot_boldly_wrong" class="doc_header"><code>BoldlyWrongTimeseries.plot_boldly_wrong</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BoldlyWrongTimeseries.plot_boldly_wrong</code>(<strong><code>nth_last</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>meter</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong><code>bid</code></strong>:<code>int</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bwt</span><span class="o">.</span><span class="n">plot_boldly_wrong</span><span class="p">(</span><span class="n">nth_last</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Adding widgets for interactive exploration</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BoldlyWrongTimeseries.init_widgets" class="doc_header"><code>BoldlyWrongTimeseries.init_widgets</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L139" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BoldlyWrongTimeseries.init_widgets</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BoldlyWrongTimeseries.run_boldly" class="doc_header"><code>BoldlyWrongTimeseries.run_boldly</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L152" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BoldlyWrongTimeseries.run_boldly</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="BoldlyWrongTimeseries.click_boldly_wrong" class="doc_header"><code>BoldlyWrongTimeseries.click_boldly_wrong</code><a href="https://github.com/eschmidt42/ashrae/tree/master/ashrae/feature_testing.py#L160" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>BoldlyWrongTimeseries.click_boldly_wrong</code>(<strong><code>change</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bwt</span><span class="o">.</span><span class="n">run_boldly</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

